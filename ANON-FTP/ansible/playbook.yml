- name: Configure anonymous FTP server with vsftpd
  hosts: anon-ftp
  become: true

  tasks:
    - name: Install vsftpd
      ansible.builtin.apt:
        name: vsftpd
        state: present
        update_cache: true

    - name: Create anonymous FTP directory
      ansible.builtin.file:
        path: /srv/ftp
        state: directory
        owner: ftp
        group: nogroup
        mode: '0555'

    - name: Copy vsftpd configuration
      ansible.builtin.copy:
        src: files/vsftpd.conf
        dest: /etc/vsftpd.conf
        owner: root
        group: root
        mode: '0644'
      notify: Restart vsftpd

    - name: Copy welcome README
      ansible.builtin.copy:
        src: files/README.md
        dest: /srv/ftp/README.md
        owner: root
        group: root
        mode: '0644'
      notify: Restart vsftpd

    - name: Enable and start vsftpd
      ansible.builtin.service:
        name: vsftpd
        enabled: true
        state: started

  handlers:
    - name: Restart vsftpd
      ansible.builtin.service:
        name: vsftpd
        state: restarted
